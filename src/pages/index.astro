---
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import Logo from "../../public/musicak.png";

const f = await fetch(
  "https://script.google.com/macros/s/AKfycbz2ilrGauIAJoWzpZ3IcBv6gEato1hUWcC5p-1OJctJZcmwSIiLvrA5n5c8QZ9E5Mb3/exec?t=list&start=0&end=50",
  { cache: "reload" }
);
const data = await f.json();
---

<Layout title="رادیو موزیکک" lang="fa" dir="rtl">
  <section
    class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 w-full gap-0.5"
  >
    <div
      id="pDiv"
      class="sticky w-full h-50 col-span-full md:col-span-2 top-0.5 z-20 rounded shadow backdrop-blur-lg"
    >
      <iframe
        class="w-full h-50 opacity-80"
        id="player"
        width="100%"
        src=`https://castbox.fm/app/castbox/player/id4804438/id${data[0]?.cast}?v=8.22.11&hide_list=1&autoplay=0`
      ></iframe>
    </div>
    {
      data.map((d: any) => {
        return (
          <a
            class="flex flex-col relative border-2 rounded overflow-hidden border-slate-300 dark:border-slate-600 hover:scale-101 transition-all duration-300"
            data-cast={d.cast}
          >
            <h1 class="z-10 absolute backdrop-blur-lg p-1 m-0.5 text-xs md:text-sm bg-gray-300/65 rounded-xs text-gray-800 shadow">
              {d.title}
            </h1>
            <img
              class="aspect-square size-full object-cover"
              id={d.picId}
              src={"pic/" + d.picId}
              alt={d.title}
              loading="lazy"
            />
          </a>
        );
      })
    }
  </section>
</Layout>

<script>
  import { scroll, animate } from "motion";
  const animation = animate(
    "#pDiv",
    { transform: ["scale(100%)", "scale(95%)"] },
    { ease: "linear" }
  );
  scroll(animation);
  const links = document.querySelectorAll("section > a");
  links.forEach((i: any) =>
    i.addEventListener("click", () => {
      const elm: any = document.getElementById("player");
      elm.src = `https://castbox.fm/app/castbox/player/id4804438/id${i.dataset.cast}?v=8.22.11&hide_list=1&autoplay=1`;
    })
  );
</script>
